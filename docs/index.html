<head>
  <title>webstack</title>
  <link rel="shortcut icon" type="image/png" href="favicon.ico">
  <style>
    @import url('https://rsms.me/inter/inter.css');
    html { font-family: 'Inter', sans-serif; }
    @supports (font-variation-settings: normal) {
      html { font-family: 'Inter var', sans-serif; }
    }
    body {
      margin: 0;
      padding: 0;
    }
    nav {
      overflow: hidden;
      background-color: #f8f8f8;
      position: fixed;
      padding: 32px;
      top: 0;
      width: 100%;
    }
    main,
    section {
      padding: 96px 32px 6px 32px;
    }
    nav a {
      padding: 0 6px;
    }
    nav a:first-child {
      padding: 0 6px 0 0;
    }
    iframe {
      border: none;
      width: 100%;
    }
    .dash-main {
      height: 720px;
    }
    .dash-ruby {
      height: 450px;
    }
    .dash-serverless {
      height: 310px;
    }
    .dash-fly {
      height: 310px;
    }
    p,
    li {
      line-height: 1.5em;
      max-width: 700px;
    }
    pre,
    code {
      font-size: 1.15em;
      line-height: 1.25em;
      margin: 0;
      padding: 0;
    }
  </style>
  <script>
    // if (localStorage.language === "") {
    //   localStorage.language = "Ruby";
    // }
  </script>
</head>
<body>
  <nav>
    <a href="#overview">overview</a>
    <a href="#heroku">heroku</a>
    <!--<a href="#serverless">serverless</a>-->
    <a href="#fly">fly</a>
    <a href="#railway">railway</a>
    <a href="#render">render</a>
  </nav>

  <main id="overview">
    <h1>webstack</h1>
    <p>
      <i>A project to prototype web stacks</i>
    </p>
    <p>
      <a href="https://status.heroku.com/incidents/2413">Heroku incident
        2413</a> is creating a search for a new backend hosting provider:
    </p>
    <ul>
      <!--<li><a href="https://encore.dev/">Encore</a></li>-->
      <li><a href="https://fly.io">Fly.io</a></li>
      <li><a href="https://railway.app">Railway</a></li>
      <li><a href="https://render.com">Render</a></li>
    </ul>
    <p>
      Each stack serves a healthcheck-style HTTP API endpoint that executes a
      <code>SELECT 1</code> to a SQL database
      and responds with JSON <code>{ "status": "ok" }</code>.
      Each stack uses a lightweight router, database connection pool,
      and SQL database driver (no ORM). Example:
    </p>
    <pre>
      <code>
require "connection_pool"
require "pg"
require "sinatra"

pool = ConnectionPool.new(size: 5, timeout: 5) {
  PG.connect(ENV.fetch("DATABASE_URL"))
}

get "/" do
  pool.with { |db| db.exec("SELECT 1") }
  content_type :json
  {status: "ok"}.to_json
end</code>
    </pre>
    <p>
      See code for all stacks at
      <a
        href="https://github.com/croaky/webstack">github.com/croaky/webstack</a>.
    </p>
    <p>
      API checks from N. California, Montreal, Ireland, Stockholm, and Sydney:
    </p>
  </main>

  <iframe class="dash-main" src="https://webstack.checklyhq.com/"></iframe>

  <!--
  <section id="ruby">
    <h2>ruby</h2>
    <p>
      Ruby makes "developer happiness" a core goal but is not scoring well by
      that metric. See "most loved" in
      <a href="https://insights.stackoverflow.com/survey/2021#most-loved-dreaded-and-wanted-language-love-dread">Stack Overflow's
         annual developer survey</a>:
    </p>
    <ul>
      <li>87% Rust</li>
      <li>73% TypeScript</li>
      <li>72% Elixir</li>
      <li>68% Python</li>
      <li>64% Swift</li>
      <li>63% Go</li>
      <li>62% SQL</li>
      <li>62% Kotlin</li>
      <li>62% JavaScript</li>
      <li>60% HTML/CSS</li>
      <li>59% Crystal</li>
      <li>56% Bash</li>
      <li>53% Ruby</li>
      <li>49% C++</li>
      <li>47% Java</li>
      <li>40% C</li>
    </ul>
    <p>
      If the survey respondents are like me,
      they enjoy writing small Ruby programs but in larger programs,
      find it easier to understand and change code in
      in other stacks like Go.
    </p>
    <p>
      As part of this project, I hope to test <a href="https://sorbet.org/">Sorbet</a>.
      I suspect I'll feel similarly as
      <a
        href="https://brandur.org/fragments/large-scale-ruby-refactoring">Brandur
        here</a>.
    </p>
  </section>
  -->

  <section id="heroku">
    <h2>heroku</h2>
    <p>
      From 2009-2022, my stack most often included Heroku + Postgres:
    </p>
    <ul>
      <li>
        Version code in a GitHub repo
      </li>
      <li>
        Open GitHub pull requests w/
        <a href="https://www.thoughtworks.com/continuous-integration">CI</a>
      </li>
      <li>
        Merge into <code>main</code> branch to auto-deploy to staging
        environment
      </li>
      <li>
        Promote staging manually to production environment in a
        <a href="https://devcenter.heroku.com/articles/pipelines">pipeline</a>
      <li>
        Configure production database with a
        <a
          href="https://devcenter.heroku.com/articles/heroku-postgres-follower-databases">follower</a>
      </li>
    </ul>
    <p>
      Heroku's GitHub integration broke April 2022 in
      <a href="https://status.heroku.com/incidents/2413">incident 2413</a> and
      has not been restored.
      Heroku also lacks overdue features that e.g. Render now supports:
    </p>
    <ul>
      <li>
        HTTP/2 support
      </li>
      <li>
        <a href="https://render.com/docs/databases">IP access control on
          Postgres databases</a>
      </li>
      <li>
        <a href="https://render.com/docs/ddos-protection">DDoS
          protection</a>
      </li>
      <li>
        <a href="https://render.com/docs/deploys#zero-downtime-deploys">Health checks</a>
      </li>
    </ul>
  </section>

  <!--
  <section id="serverless">
    <h2>serverless</h2>
    <p>
      For <a href="https://github.com/croaky/webstack/tree/main/deno-deploy">Deno Deploy</a>
      and
      <a href="https://github.com/croaky/webstack/tree/main/vercel-go">Vercel
        serverless Go function</a>,
      I used
      <a href="https://supabase.com/">Supabase</a>
      for the database.
    </p>
    <p>
      My higher priority right now, though, is "lifting and shifting"
      my traditional "serverful" stacks
      from Heroku to Fly, Railway, or Render.
    </p>
    <p>
      The latency is also higher for serverless stacks.
      Mostly due to database connection cost?
    </p>
  </section>
  -->

  <iframe class="dash-serverless" src="https://webstack-serverless.checklyhq.com/"></iframe>

  <section id="fly">
    <h2>fly</h2>
    <p>
      I wrote and deployed Go (stdlib) and Ruby (Sinatra) apps to
      <a href="https://fly.io/">Fly.io</a>'s San Jose region on April 6, 2022.
      From then until May 6 2022, I observed 99.96% uptime on the Go app
      and 99.88% uptime on the Ruby app. No surpise, the N. California check
      showed particularly excellent P50 latencies of 71ms and 63ms (the Ruby app
      was actually lower?!).
    </p>
    <p>
      Pros
    </p>
    <ul>
      <li>
        I was able to get excellent performance and reliability from Fly.io.
      </li>
      <li>
        The CLI is fantastic and feels like I can find out all information about
        my service from it.
      </li>
    </ul>
    <p>
      Cons
    </p>
    <ul>
      <li>
        To deploy, I had to install Docker (~1.5GB) on my laptop (Apple M1
        chip). Without it,
        <a href="https://github.com/croaky/webstack/tree/main/fly-go">I observed
           errors</a>. It seems like Docker should not have been required
         because the <code>flyctl launch</code> command's
         <code>--remote-only</code> flag is true by default.
      </li>
      <li>
        The web UI doesn't contain all information for the app
        and is not as aesthetic as Railway, Heroku, or Render.
      </li>
    </ul>
    <p>
      TODOs
    </p>
    <ul>
      <li>
        Try
        <a
          href="https://fly.io/docs/getting-started/multi-region-databases/">multi-region
          Postgres read replicas</a>.
        If I re-instrumented my apps to use this feature, Fly would probably win
        on these read performance checks globally?
      </li>
      <li>
        Try
        <a href="https://fly.io/blog/all-in-on-sqlite-litestream/">SQLite +
          Litestream</a>. It looks like docs haven't been written for this yet?
      </li>
    </ul>
  </section>

  <iframe class="dash-fly" src="https://webstack-fly.checklyhq.com/"></iframe>

  <section id="railway">
    <h2>railway</h2>
    <p>
      Pros
    </p>
    <ul>
      <li>
        The web UI is absolutely amazing. It is really, really pretty and
        functional.
      </li>
    </ul>
  </section>

  <section id="render">
    <h2>render</h2>
  </section>
</body>
